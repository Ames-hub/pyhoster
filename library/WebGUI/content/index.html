<!DOCTYPE html>
<html>
<head>
    <title>PyHost GUI</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="PyhostLogo.png">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" href="css/sidebar.css">
</head>
<body>
    <noscript>
        <div style="color: white;">
            <h1>JavaScript is disabled</h1>
            <p>
                JavaScript is required for this website to function at all. Please allow me to run JavaScript and reload the page.<br><br>
                
                If you have privacy concerns, you can read the JS code yourself at our
                <a href="https://github.com/Ames-hub/pyhoster/tree/main/library/WebGUI/content">github repo</a><br>
                (https://github.com/Ames-hub/pyhoster/tree/main/library/WebGUI/content)<br><br>
                
                We promise, the WORST you'll find is a "SameSite: Lax" (not sent cross-site) cookie that keeps your session token for authentication.
            </p>
        </div>
    </noscript>
    <sidebar class="sidebar">
        <img src="PyhostLogo.gif" alt="logo" id="business_logo">
        <h1 id="title">Interaction panel</h1>
        <div id="status_detector">
            <span id="status_text">Pending</span>
        </div>
        <hr>
        <nav id="nav">
            <!-- Makes all the tabs -->
            <!--<a id="nav_login" href="login.html" class="nav-link">Login</a>-->
            <a id="nav_index" href="index.html" class="nav-link">Home</a>
            <a id="nav_instances" href="x.html" class="nav-link">Manage Apps</a>
            <a id="nav_userman" href="x.html" class="nav-link">Manage Users</a>
            <a id="nav_warden" href="x.html" class="nav-link">Access Warden</a>
            <a id="nav_ftp" href="x.html" class="nav-link">Manage FTP</a>
            <a id="nav_api" href="x.html" class="nav-link">API</a>
            <a id="nav_settings" href="x.html" class="nav-link">Settings</a>
        </nav>
    </sidebar>
    <div id="apps_bar">
        <!-- For every app, an app will be put here -->
    </div>
    <script>
        // This is the token that will be used to authenticate the user. Gotten from the login page
        function get_token() {
            let sessionCookie = document.cookie.split('; ').find(row => row.startsWith('session'));
            return sessionCookie ? sessionCookie.split('=')[1] : null;
        }

        // Sends the user to the login page if the token is not found or an error occurs while getting the token
        function sendToLogin() {
            let tkn = get_token()
            fetch('http://localhost:4045', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    token: tkn
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status != "ok") {
                    console.log(data.status)
                    window.location.href = "login.html";
                }
            })

            if (tkn == undefined || tkn == null || tkn == "") {
                window.location.href = "login.html";
            }
        }

        sendToLogin() // Do it initially before loop
        setInterval(() => {
           sendToLogin();
        }, 5000);
    </script>
    <script src="javascript/getAllStats.js"></script>
    <script src="javascript/stop_app.js"></script>
    <script src="javascript/start_app.js"></script>
    <script src="javascript/status_detector.js"></script>
</body>
</html>